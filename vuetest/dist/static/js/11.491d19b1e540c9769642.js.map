{"version":3,"sources":["webpack:///src/components/photo.vue","webpack:///./src/components/photo.vue?aea9","webpack:///./src/components/photo.vue"],"names":["photo","init","http","_this","this","then","res","data","url","thumb","_this2","id","_this3","_this4","_this5","FormData","close","components_photo","render","_vm","_h","$createElement","_c","_self","staticClass","attrs","src","loginImg","alt","_v","name","accept","type","on","change","$event","uploadPhoto","staticStyle","width","size","_l","item","index","key","click","setCover","delImage","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"sHA4BAA,yCAIA,kBACA,mBAEA,WAEA,6BAGAC,oBACAC,EAAA,4BAGA,IAAAC,EAAAC,wBACA,sBAAAC,KAAA,SAAAC,uBAEA,eACAC,6EAEAC,2DAIAC,qCAIA,0BAAAJ,KAAA,SAAAC,oDAGAC,qDAGA,oFAQA,qDAMA,IAAAG,EAAAN,kDACAO,GAAAN,KAAA,SAAAC,uBAGAL,0CACA,2DAGA,qDAMA,IAAAW,EAAAR,gEAEA,sBACA,UACA,YAHAC,KAAA,oBAKAM,uCAGA,eAEA,gCAGA,IAAAE,EAAAT,kDACAO,GAAAN,KAAA,SAAAC,uBAGAL,0CACA,2DAGA,wDAMA,IAAAa,EAAAV,WACAW,yCAKA,mDACA,oDAMA,0BAGA,wEANA,yBAQAV,KAAA,SAAAC,8CAIAU,6CAEA,YACAf,kCAGAe,6FCjJAC,GADiBC,OAFjB,WAA0B,IAAAC,EAAAf,KAAagB,EAAAD,EAAAE,eAA0BC,EAAAH,EAAAI,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,UAAoBF,EAAA,OAAYE,YAAA,SAAmBF,EAAA,OAAYE,YAAA,YAAsBF,EAAA,OAAYG,OAAOC,IAAAP,EAAAQ,SAAAC,IAAA,QAA6BT,EAAAU,GAAA,KAAAP,EAAA,OAA0BE,YAAA,WAAqBF,EAAA,SAAcG,OAAOK,KAAA,OAAAC,OAAA,wCAAAC,KAAA,QAA6EC,IAAKC,OAAA,SAAAC,GAA0BhB,EAAAiB,YAAAD,OAA0BhB,EAAAU,GAAA,KAAAP,EAAA,aAA8Be,aAAaC,MAAA,SAAgBb,OAAQO,KAAA,UAAAO,KAAA,WAAiCpB,EAAAU,GAAA,gBAAAV,EAAAU,GAAA,KAAAV,EAAAqB,GAAArB,EAAA,cAAAsB,EAAAC,GAA4E,OAAApB,EAAA,OAAiBqB,IAAAD,EAAAlB,YAAA,QAA4BF,EAAA,OAAYG,OAAOC,IAAAe,EAAAjC,IAAAoB,IAAA,MAAyBT,EAAAU,GAAA,KAAAP,EAAA,OAAwBE,YAAA,QAAkBF,EAAA,QAAaW,IAAIW,MAAA,SAAAT,GAAyBhB,EAAA0B,SAAAJ,EAAA9B,QAAwBQ,EAAAU,GAAA,UAAAP,EAAA,QAA8BW,IAAIW,MAAA,SAAAT,GAAyBhB,EAAA2B,SAAAL,EAAA9B,QAAwBQ,EAAAU,GAAA,eAAqB,IAEr4BkB,oBCCjB,IAcAC,EAdAC,EAAA,OAcAC,CACAlD,EACAiB,GATA,EAVA,SAAAkC,GACAF,EAAA,SAaA,kBAEA,MAUAG,EAAA,QAAAJ,EAAA","file":"static/js/11.491d19b1e540c9769642.js","sourcesContent":["/*\n * @Author: zhengu.jiang \n * @Date: 2018-06-02 15:20:13 \n * @Module: {照片添加} \n */\n\n<template>\n    <div class=\"photo\">\n        <div class=\"main\">\n            <div class=\"default\">\n                <img :src=\"loginImg\" alt=\"\">\n            </div>\n            <div class=\"upload\">\n                <input name=\"file\" accept=\"image/jpeg,image/png,image/image/tiff\" type=\"file\" @change=\"uploadPhoto($event)\"/>\n                <el-button type=\"primary\" size=\"small\" style=\"width:130px\">上传照片</el-button>\n            </div>\n        </div>\n        <div class=\"img\" v-for=\"(item,index) in list\" :key=\"index\">\n            <img :src=\"item.url\" alt=\"\">\n            <div class=\"set\">\n                <span @click=\"setCover(item.id)\">设为封面</span><span @click=\"delImage(item.id)\">删除</span>\n            </div>\n        </div>\n        \n    </div>\n</template>\n<script>\nimport api from \"./http.js\"\nexport default {\n    data() {\n        return {\n            dialogImageUrl: '',\n            dialogVisible: false,\n            list: [],\n            loginImg: '',\n            imgHost: ''\n        }\n    },\n    mounted(){\n        this.init();\n        this.imgHost = api;\n    },\n    methods: {\n        init(){\n            this.$http.get(api + '/api/image/getList')\n            .then((res)=>{\n                if(res.data.code == 200){\n                    this.list = res.data.data;\n                    for(let i = 0; i < this.list.length; i++){\n                        this.list[i].thumb = this.imgHost + '/' + this.list[i].url;\n                    }\n                    this.list.filter(res=>{\n                        if(res.is_cover == 1){\n                            this.loginImg = res.thumb;\n                        }\n                    });\n                    if(!this.loginImg){\n                        this.$http.get(api + '/api/Login/getCoverUrl')\n                            .then((res)=>{\n                                if(res.data.code == 200){\n                                    this.loginImg = this.imgHost + '/' + res.data.data;\n                                }else{\n                                    this.$alert(res.data.error, '温馨提示', {\n                                        confirmButtonText: '确定',\n                                        callback: ()=>{}\n                                    });\n                                }\n                            })\n                    }\n                }else{\n                    this.$alert(res.data.error, '温馨提示', {\n                        confirmButtonText: '确定',\n                        callback: ()=>{}\n                    });\n                }\n            })\n        },\n        setCover(id){\n            this.$http.get(api + '/api/image/setCover?id=' + id)\n            .then((res)=>{\n                if(res.data.code == 200){\n                    this.init();\n                    this.$message({type: 'success',message: '设置成功！'})\n                }else{\n                    this.$alert(res.data.error, '温馨提示', {\n                        confirmButtonText: '确定',\n                        callback: ()=>{}\n                    });\n                }\n            })\n        },\n        delImage(id){\n            this.$confirm('此操作将永久删除该照片, 是否继续?', '提示', {\n                    confirmButtonText: '确定',\n                    cancelButtonText: '取消',\n                    type: 'warning'\n                }).then(() => {\n                    this.delimg(id);\n                }).catch(() => {\n                    this.$message({\n                        type: 'info',\n                        message: '已取消删除'\n                    });          \n                });\n        },\n        delimg(id){\n            this.$http.get(api + '/api/image/delImage?id=' + id)\n            .then((res)=>{\n                if(res.data.code == 200){\n                    this.init();\n                    this.$message({type: 'success',message: '删除成功！'})\n                }else{\n                    this.$alert(res.data.error, '温馨提示', {\n                        confirmButtonText: '确定',\n                        callback: ()=>{}\n                    });\n                }\n            })\n        },\n        uploadPhoto(e){\n            let param = new FormData(); \n            // for(var i=0, f; f=e.target.files[i]; i++){\n            //     var name = []\n            //     param.append('image['+i+']', f);\n            // }\n            param.append('image',e.target.files[0])\n            param.append('access_token', sessionStorage.getItem('token'));\n            let config = {\n                headers:{'Content-Type':'multipart/form-data'}\n            };  \n            const instance=this.$http.create({\n                withCredentials: true\n            })\n            let options = {\n                text: '正在上传...'\n            }\n            const loading = this.$loading(options);\n            instance.post(api + '/api/Image/addImage',param,config)  \n            .then(res=>{  \n                if(res.data.code == 200){\n                    this.$nextTick(()=>{\n                        loading.close();\n                    })\n                    this.$message({type: 'success',message: '上传成功！'})\n                    this.init();\n                }else{\n                    this.$nextTick(()=>{\n                        loading.close();\n                    })\n                    this.$alert(res.data.error, '温馨提示', {confirmButtonText: '确定',callback: ()=>{}});\n                }\n            })\n        }\n    }\n}\n</script>\n<style lang=\"less\" scoped>\n    .photo{\n        .main{\n            height: 100%;\n            width: 200px;\n            border: 1px solid #ccc;\n            padding: 10px;\n            .default{\n                width: 100%;\n                img{\n                    width: 100%;\n                }\n            }\n            .upload{\n                position: relative;\n                display: inline-block;\n                overflow: hidden;\n                vertical-align: middle;\n                margin-left: 25px;\n                margin-top: 5px;\n                input{\n                    position: absolute;\n                    top: 0;\n                    left: 0;\n                    opacity: 0;\n                    -ms-filter: 'alpha(opacity=0)';\n                    width: 0;\n                    padding-left: 130px;\n                    cursor: pointer;\n                }\n            }\n        }\n        .img{\n            margin: 20px;\n            height: 250px;\n            position: relative;\n            display: inline-block;\n            img{\n                height: 100%;\n            }\n            .set{\n                display: none;\n                span{\n                    display: inline-block;\n                    width: 50%;\n                }\n            }\n            &:hover .set{\n                display: inline-block;\n                width: 100%;\n                height: 40px;\n                background-color: rgba(0,0,0,0.5);\n                color: #fff;\n                position: absolute;\n                bottom: 0;\n                text-align: center;\n                line-height: 40px;\n                cursor: pointer;\n            }\n        }\n    }\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/components/photo.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"photo\"},[_c('div',{staticClass:\"main\"},[_c('div',{staticClass:\"default\"},[_c('img',{attrs:{\"src\":_vm.loginImg,\"alt\":\"\"}})]),_vm._v(\" \"),_c('div',{staticClass:\"upload\"},[_c('input',{attrs:{\"name\":\"file\",\"accept\":\"image/jpeg,image/png,image/image/tiff\",\"type\":\"file\"},on:{\"change\":function($event){_vm.uploadPhoto($event)}}}),_vm._v(\" \"),_c('el-button',{staticStyle:{\"width\":\"130px\"},attrs:{\"type\":\"primary\",\"size\":\"small\"}},[_vm._v(\"上传照片\")])],1)]),_vm._v(\" \"),_vm._l((_vm.list),function(item,index){return _c('div',{key:index,staticClass:\"img\"},[_c('img',{attrs:{\"src\":item.url,\"alt\":\"\"}}),_vm._v(\" \"),_c('div',{staticClass:\"set\"},[_c('span',{on:{\"click\":function($event){_vm.setCover(item.id)}}},[_vm._v(\"设为封面\")]),_c('span',{on:{\"click\":function($event){_vm.delImage(item.id)}}},[_vm._v(\"删除\")])])])})],2)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-2007306e\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/photo.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-2007306e\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!less-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./photo.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./photo.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./photo.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-2007306e\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./photo.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-2007306e\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/photo.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}