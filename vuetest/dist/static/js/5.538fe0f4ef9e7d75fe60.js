webpackJsonp([5],{"3CPp":function(t,e){},"8cMb":function(t,e){},fgII:function(t,e){},"sLX/":function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o("mvHQ"),n=o.n(i),l={data:function(){return{rules:{name:[{required:!0,message:"请输入姓名",trigger:"change"}],node_list:[{required:!0,message:"请选择权限",trigger:"change"}]},tableData:[],form:{name:"",node_list:""},showForm:!1,showRule:!1,chooseRules:[],activeName2:"全部",nodes:[]}},props:["dialogForm","nodeList","edit","rule"],created:function(){this.edit&&(this.form.name=this.rule.name,this.chooseRules=this.rule.node_list,this.form.node_list=this.rule.node_list.join(","))},mounted:function(){var t=this;if(this.showForm=this.dialogForm,this.nodes=this.deepCopy(this.nodeList),this.edit)for(var e=function(e){for(var o=function(o){t.chooseRules.filter(function(i){i==t.nodes[e].child[o].id&&(t.nodes[e].child[o].selected=!0)})},i=0;i<t.nodes[e].child.length;i++)o(i)},o=0;o<this.nodes.length;o++)e(o)},methods:{deepCopy:function(t){return JSON.parse(n()(t))},chooseAll:function(t){for(var e=0;e<this.nodes.length;e++)if(this.nodes[e].id==t.id)for(var o=0;o<this.nodes[e].child.length;o++)this.checkOn(this.nodes[e].child[o],"all")},chooseReset:function(t){for(var e=0;e<this.nodes.length;e++)if(this.nodes[e].id==t.id)for(var o=0;o<this.nodes[e].child.length;o++)this.checkOn(this.nodes[e].child[o],"reset")},checkOn:function(t,e){for(var o=0;o<this.nodes.length;o++)for(var i=0;i<this.nodes[o].child.length;i++)t.id==this.nodes[o].child[i].id&&(this.nodes[o].child[i].selected=!this.nodes[o].child[i].selected,"all"==e&&(this.nodes[o].child[i].selected=!0),"reset"==e&&(this.nodes[o].child[i].selected=!1))},cancel:function(){this.$emit("close","close")},submitForm:function(t){var e=this;this.$refs[t].validate(function(t){return!!t&&(e.tableData.push(e.form),e.edit&&(e.tableData[0].node_id=e.rule.id,e.tableData[0].status=e.rule.status),console.log(e.tableData),console.log(e.tableData[0].node_list),e.tableData[0].node_list?void e.$emit("close","ok",e.tableData):(e.$alert("请添加权限","温馨提示",{confirmButtonText:"确定",callback:function(){}}),!1))})},close:function(){this.$emit("close","close")},chooseRule:function(){this.showRule=!0},enterRule:function(){this.showRule=!1,this.chooseRules=[];for(var t=0;t<this.nodes.length;t++)for(var e=0;e<this.nodes[t].child.length;e++)0===t&&this.nodes[t].child[e].selected&&this.chooseRules.push(this.nodes[t].child[e].id);this.form.node_list=this.chooseRules.join(",")},cancelRule:function(){this.showRule=!1}}},s={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"rule_win"},[o("el-dialog",{attrs:{width:"30%",height:"150%",title:"选择权限",visible:t.showRule,"append-to-body":""},on:{"update:visible":function(e){t.showRule=e}}},[o("div",[o("el-tabs",{attrs:{type:"card"},model:{value:t.activeName2,callback:function(e){t.activeName2=e},expression:"activeName2"}},t._l(t.nodes,function(e,i){return o("el-tab-pane",{key:i,attrs:{label:e.name,name:e.name}},[t._l(e.child,function(e,i){return o("div",{key:i+"a",staticClass:"el-checkbox-button el-checkbox-button--medium",class:{"is-checked":e.selected},on:{click:function(o){t.checkOn(e)}}},[o("span",{staticClass:"el-checkbox-button__inner",staticStyle:{"margin-top":"10px","margin-right":"10px"}},[t._v(t._s(e.name))])])}),t._v(" "),o("div",{staticClass:"all"},[o("span",{on:{click:function(o){t.chooseAll(e)}}},[t._v("全部选择")]),t._v(" "),o("span",{staticStyle:{color:"gray","border-color":"gray"},on:{click:function(o){t.chooseReset(e)}}},[t._v("全部取消")])])],2)}))],1),t._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.cancelRule}},[t._v("取 消")]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:function(e){t.enterRule()}}},[t._v("确 定")])],1)]),t._v(" "),o("el-dialog",{attrs:{title:"添加用户组",visible:t.showForm},on:{"update:visible":function(e){t.showForm=e},close:t.close}},[o("el-form",{ref:"form",staticClass:"ruleForm",attrs:{model:t.form,"label-width":"100px",rules:t.rules}},[o("el-form-item",{attrs:{label:"职位",prop:"name"}},[o("el-input",{model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"权限",prop:"rules"}},[o("el-button",{attrs:{type:"primary"},on:{click:t.chooseRule}},[t._v("添加权限")]),t._v(" "),o("span",[t._v("已选择"+t._s(t.chooseRules.length)+"个权限")])],1)],1),t._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.cancel}},[t._v("取 消")]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:function(e){t.submitForm("form")}}},[t._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var a=o("VU/8")(l,s,!1,function(t){o("fgII"),o("3CPp")},"data-v-062a5b55",null).exports,c=(o("olkN"),o("oVO8")),r={data:function(){return{tableData:[],dialogForm:!1,nodeList:[],outerVisible:!1,innerVisible:!1,rule:"",edit:!1,loading:!0}},components:{rule:a},mounted:function(){this.init()},methods:{init:function(){var t=this;this.$http.get(c.a+"/api/Rule/ruleList").then(function(e){if(200==e.data.code){t.tableData=e.data.data.ruleList,t.nodeList=e.data.data.nodeList;for(var o={name:"全部",child:[]},i=0;i<t.nodeList.length;i++){for(var n=0;n<t.nodeList[i].child.length;n++)t.nodeList[i].child[n].selected=!1;o.child=o.child.concat(t.nodeList[i].child)}t.nodeList.unshift(o),t.loading=!1}else t.$alert(e.data.error,"温馨提示",{confirmButtonText:"确定",callback:function(){}})}).catch(function(e){t.$alert(e,"温馨提示",{confirmButtonText:"确定",callback:function(){}})})},showDetail:function(t){this.rule=t,this.dialogForm=!0,this.edit=!0},out:function(t){var e=this;this.$confirm("此操作将永久删除该职位, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.deleteRule(t)}).catch(function(){e.$message({type:"info",message:"已取消删除"})})},deleteRule:function(t){var e=this;this.$http.get(c.a+"/api/Rule/delRule?node_id="+t).then(function(t){200==t.data.code?(e.init(),e.$message({type:"success",message:"删除成功！"})):e.$alert(t.data.error,"温馨提示",{confirmButtonText:"确定",callback:function(){}})}).catch(function(t){e.$alert(t,"温馨提示",{confirmButtonText:"确定",callback:function(){}})})},add:function(){this.dialogForm=!0,this.edit=!1},cancel:function(){this.dialogForm=!1},dialog:function(t,e){var o=this;this.dialogForm=!1,"ok"==t&&(this.edit?this.$http.post(c.a+"/api/Rule/editRule",e[0]).then(function(t){200==t.data.code?(o.$message({type:"success",message:"编辑成功！"}),o.init()):o.$alert(t.data.error,"温馨提示",{confirmButtonText:"确定",callback:function(){}})}).catch(function(t){o.$alert(t,"温馨提示",{confirmButtonText:"确定",callback:function(){}})}):this.$http.post(c.a+"/api/Rule/addRule",e[0]).then(function(t){200==t.data.code?(o.$message({type:"success",message:"添加成功！"}),o.init()):o.$alert(t.data.error,"温馨提示",{confirmButtonText:"确定",callback:function(){}})}).catch(function(t){o.$alert(t,"温馨提示",{confirmButtonText:"确定",callback:function(){}})}))}}},d={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("el-button",{attrs:{type:"primary"},on:{click:t.add}},[t._v("添加用户组")]),t._v(" "),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"1002px","margin-top":"20px"},attrs:{data:t.tableData,border:""}},[o("el-table-column",{staticStyle:{width:"20%"},attrs:{prop:"name",label:"职位",align:"center"}}),t._v(" "),o("el-table-column",{staticStyle:{width:"20%"},attrs:{prop:"node_list.length",label:"权限数量",align:"center"}}),t._v(" "),o("el-table-column",{staticStyle:{width:"20%"},attrs:{label:"操作",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-button",{attrs:{type:"text",size:"small"},on:{click:function(o){t.showDetail(e.row)}}},[t._v("编辑")]),t._v(" "),o("el-button",{staticStyle:{color:"red"},attrs:{type:"text",size:"small"},on:{click:function(o){t.out(e.row.id)}}},[t._v("删除")])]}}])})],1),t._v(" "),t.dialogForm?o("rule",{attrs:{edit:t.edit,rule:t.rule,nodeList:t.nodeList,dialogForm:t.dialogForm},on:{close:t.dialog}}):t._e()],1)},staticRenderFns:[]};var u=o("VU/8")(r,d,!1,function(t){o("8cMb")},"data-v-ef92fa64",null);e.default=u.exports}});
//# sourceMappingURL=5.538fe0f4ef9e7d75fe60.js.map